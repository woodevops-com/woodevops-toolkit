#!/bin/bash
systemctl stop nginx
systemctl stop php8.1-fpm
systemctl stop systemd-journald

mv -n /config.json /etc/woodevops-toolkit/config.json

ORIGINAL_PHP_INI='/etc/php/8.1/fpm/php.ini'
CUSTOM_PHP_INI='/etc/woodevops-toolkit/custom_files/php.ini'

cp -f $CUSTOM_PHP_INI $ORIGINAL_PHP_INI

ORIGINAL_NGINX_CONF='/etc/nginx/nginx.conf'
CUSTOM_NGINX_CONF='/etc/woodevops-toolkit/custom_files/nginx.conf'

cp -f $CUSTOM_NGINX_CONF $ORIGINAL_NGINX_CONF

cp -f /etc/woodevops-toolkit/scripts/create_nginx_config_files /usr/local/bin/create_nginx_config_files

php /etc/woodevops-toolkit/scripts/update_php_ini
php /etc/woodevops-toolkit/scripts/update_journald_conf
php /etc/woodevops-toolkit/scripts/create_nginx_config_files all

systemctl enable nginx
systemctl start nginx
systemctl enable php8.1-fpm
systemctl start php8.1-fpm
systemctl enable systemd-journald
systemctl start systemd-journald